В kafkac-clients 2.5.0 поддерживаются 2 протокола ребалансировки
 - eager
 - cooperative

Сейчас используется EAGER(stop-the-world) протокол, который выглядит следующим образом:
	- общение между брокером и членами группы потрелителей происходит через лидера группа
	- каждый участник должен отозвать принадлежащие ему партиции перед тем как отправить запрос на присоденинение к группе (JoinGroup)
	- метод отзыва всегда вызывается перед перебалансировкой и является последней возможностью зафиксировать оффсеты перед переназначением партиций
	- после ребалансировки с помощью лидера членам группы назначаются новые разделы. До этого момента ни однин участник группы не может выполнять никакую работу

!!! По умолчанию потребитель настроен на использование политики автоматической фиксации, которая запускает фиксацию с периодическим интервалом. При выборе такой фиксации все сообщения будут гарантированно доставлены, но могут быть дубликаты. Автоматическая фиксация  работает как cron с периодом, установленным в auto.commit.interval.ms свойстве конфигурации. 

В случае перебалансировки положение всех партиций будет сброшено до последнего зафиксированного смещения => любые сообщения, пришедшие с момента последней фиксации, нужно будет прочитать повторно
Синхронная фиксация коммитов - будет пытаться закоммитить оффсет бесконечно долго, пока не получит неисправимую ошибку


**_rebalance.max.retries_** - кол-во раз, которое будет пытаться выполниться ребалансировка перед отказом


_Group Coordinator_ принимает от консьюмеров heartbeat-ы и poll-ы и управляет их оффсетами
_Group Leader_ - принимвет решение о назначении партиций за всех участников группы

Note that max.poll.records is only applied on the consumer side. Under the cover, the size of batches fetched from brokers is controlled by max.partition.fetch.bytes, fetch.min.bytes and fetch.max.bytes
Механизм перебалансировки на самом деле структурирован вокруг двух протоколов: протокола членства в группе и встроенного протокола клиента

Вступлеие в группу:
 1) FindCoordinator на получение координатора
 2) JoinGroup запрос - инициализация протокола перебалансировки

onPartitionsAssigned - вызывается, когда потребитель получает назначенные ему партиции от координатора

Перебалансировка при правильной остановке:
- один из челнов группы отправляетleave запрос координатору
- остальные потребитель будут уведомлены о том, что перебалансировка будет выполнена в след раз
- Join/Sync_Group запросы
- Пока разделы не переназначены, потребители больше не обрабатывают какие-либо данные(по умолчанию 5 минут)

Перебалансировка при аварийном сбое:
- Если потребитель отключен из-за временного сбоя, координатор брокера не будет информировать других потребителей о необходимости перебалансировки до тех пор, пока не будет достигнут session.timeout.ms


**session.timeout.ms** - таймаут по истечению которого потребитель будет исключен из группы, в течение этого времени необходимо отправлять heartbetы  10 секунд, должно быть в интервале от group.min.session.timeout.ms до max
**max.poll.interval.ms** - максимальная задержка между вызовами poll() 5 минут


pollAndInvoke - обертка springBootListener-а.
 В ней сначала вызывается commitSync(если необходимо), а только потом poll()














